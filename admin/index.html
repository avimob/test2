<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex,nofollow">
  <script>
    if (
      !window.location.pathname.endsWith("/") &&
      !window.location.pathname.endsWith(".html")
    ) {
      window.location.replace(
        `${window.location.pathname}/${window.location.search}${window.location.hash}`,
      );
    }
  </script>
  <title>Painel Administrativo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <header class="hero">
    <div class="hero-copy">
      <p class="eyebrow">Area administrativa</p>
      <h1>Painel de gerenciamento de imoveis.</h1>
      <p>
        Cadastre, edite e remova imoveis. O catalogo publico atualiza automaticamente.
      </p>
    </div>
    <a class="admin-anchor" href="../">Voltar para o site</a>
  </header>

  <main class="layout">
    <section class="panel filters-panel" aria-label="Filtros de imoveis">
      <div class="panel-title">
        <h2>Filtros</h2>
        <button id="clear-filters" type="button" class="ghost-button">Limpar</button>
      </div>

      <div id="global-status" class="status-banner status-info hidden" role="status"></div>

      <label class="field">
        <span>Valor minimo (R$)</span>
        <input id="min-price" type="number" min="0" step="1000" placeholder="Ex: 200000">
      </label>

      <label class="field">
        <span>Valor maximo (R$)</span>
        <input id="max-price" type="number" min="0" step="1000" placeholder="Ex: 900000">
      </label>

      <div class="filter-block">
        <p>Tipo de imovel</p>
        <div id="type-filters" class="checkbox-group"></div>
      </div>

      <div class="filter-block">
        <p>Bairro</p>
        <div id="neighborhood-filters" class="checkbox-group">
          <span class="muted">Sem bairros cadastrados.</span>
        </div>
      </div>

      <div class="filter-block">
        <p>Quartos</p>
        <div id="bedroom-filters" class="checkbox-group">
          <span class="muted">Sem dados de quartos.</span>
        </div>
      </div>
    </section>

    <section class="catalog-panel">
      <div class="catalog-header">
        <h2>Imoveis disponiveis</h2>
        <p id="results-count" class="muted">0 resultados</p>
      </div>

      <div id="property-grid" class="property-grid"></div>

      <div id="empty-catalog" class="empty-state hidden">
        <h3>Nenhum imovel encontrado</h3>
        <p>Ajuste os filtros ou cadastre um novo imovel no painel administrativo.</p>
      </div>
    </section>

    <aside class="panel admin-panel" id="painel-admin">
      <div class="panel-title stacked">
        <h2>Painel administrativo</h2>
        <p>Adicione, edite e remova imoveis com upload de multiplas fotos.</p>
      </div>

      <div id="admin-status" class="status-banner status-info hidden" role="status"></div>

      <form id="admin-login-form" class="admin-login-form">
        <h3>Acesso admin</h3>
        <label class="field">
          <span>E-mail</span>
          <input name="email" type="email" autocomplete="username" required placeholder="seuemail@exemplo.com">
        </label>
        <label class="field">
          <span>Senha</span>
          <input name="password" type="password" autocomplete="current-password" required placeholder="Sua senha do Supabase Auth">
        </label>
        <button type="submit" class="primary-button full-width">Entrar</button>
      </form>

      <section id="admin-content" class="hidden">
        <div class="admin-tools">
          <button id="logout-button" type="button" class="ghost-button">Sair</button>
        </div>

        <form id="property-form" class="property-form">
          <h3 id="property-form-title">Cadastrar novo imovel</h3>
          <input id="property-id" type="hidden">

          <label class="field">
            <span>Titulo</span>
            <input id="property-title" type="text" required placeholder="Ex: Casa com area gourmet">
          </label>

          <label class="field">
            <span>Descricao</span>
            <textarea id="property-description" rows="3" required placeholder="Diferenciais, metragem, condominio, etc."></textarea>
          </label>

          <div class="form-grid">
            <label class="field">
              <span>Valor (R$)</span>
              <input id="property-price" type="number" min="0" step="1000" required>
            </label>

            <label class="field">
              <span>Quartos</span>
              <input id="property-bedrooms" type="number" min="0" step="1" required>
            </label>
          </div>

          <div class="form-grid">
            <label class="field">
              <span>Bairro</span>
              <input id="property-neighborhood" type="text" required placeholder="Ex: Centro">
            </label>

            <label class="field">
              <span>Localizacao</span>
              <input id="property-location" type="text" required placeholder="Cidade/UF ou endereco resumido">
            </label>
          </div>

          <div class="form-grid">
            <label class="field">
              <span>Tipo</span>
              <select id="property-type" required>
                <option value="casa">Casa</option>
                <option value="apartamento">Apartamento</option>
                <option value="kitnet">Kitnet</option>
                <option value="terreno">Terreno</option>
                <option value="loja">Loja</option>
              </select>
            </label>

            <label class="field">
              <span>WhatsApp de contato</span>
              <input id="property-whatsapp" type="text" required placeholder="55DDDNUMERO">
            </label>
          </div>

          <label class="field">
            <span>Fotos do imovel</span>
            <input id="image-input" type="file" accept="image/*" multiple capture="environment">
          </label>
          <p class="muted compact">
            As imagens sao comprimidas automaticamente antes do upload (formato WebP).
          </p>

          <div id="image-preview" class="image-preview">
            <div class="empty-inline">Nenhuma imagem selecionada.</div>
          </div>

          <div class="form-actions">
            <button id="save-property-button" type="submit" class="primary-button">Salvar imovel</button>
            <button id="cancel-edit-button" type="button" class="ghost-button hidden">Cancelar edicao</button>
          </div>
        </form>

        <div class="admin-list-section">
          <h3>Imoveis cadastrados</h3>
          <div id="admin-property-list" class="admin-property-list"></div>
        </div>
      </section>
    </aside>
  </main>

  <template id="property-card-template">
    <article class="property-card">
      <div class="property-image-wrap">
        <img class="property-image" src="" alt="">
      </div>
      <div class="property-body">
        <p class="property-price"></p>
        <h3 class="property-title"></h3>
        <p class="property-location muted"></p>
        <div class="property-tags"></div>
        <p class="property-description"></p>
        <a class="whatsapp-button" target="_blank" rel="noopener noreferrer">Falar no WhatsApp</a>
      </div>
    </article>
  </template>

  <template id="admin-item-template">
    <article class="admin-item">
      <div>
        <h4 class="admin-item-title"></h4>
        <p class="admin-item-meta"></p>
      </div>
      <div class="admin-item-actions">
        <button type="button" class="ghost-button small" data-action="edit">Editar</button>
        <button type="button" class="danger-button small" data-action="delete">Remover</button>
      </div>
    </article>
  </template>

  <script src="../supabase-config.js"></script>
  <script type="module" src="../app.js"></script>
</body>
</html>
